<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Hitung Sisi A3 Softcover</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f0f2f8;
      padding: 30px;
    }
    .container {
      max-width: 700px;
      margin: auto;
      background: white;
      padding: 30px;
      border-radius: 16px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.1);
    }
    h2 {
      text-align: center;
      color: #0077cc;
      margin-bottom: 20px;
    }
    label {
      margin-top: 12px;
      display: block;
      font-weight: 500;
    }
    select, input, button {
      width: 100%;
      padding: 10px;
      margin-top: 6px;
      border-radius: 8px;
      border: 1px solid #ccc;
    }
    button {
      background: #0077cc;
      color: white;
      margin-top: 20px;
      font-weight: bold;
      cursor: pointer;
    }
    button:hover {
      background: #005fa3;
    }
    .result {
      background: #f1f9ff;
      padding: 20px;
      margin-top: 25px;
      border-left: 5px solid #0077cc;
      border-radius: 8px;
    }
    .impose-layout {
      margin-top: 20px;
    }
    .layer {
      display: flex;
      gap: 10px;
      margin-bottom: 12px;
      align-items: center;
    }
    .boxes {
      gap: 4px;
    }
    .grid {
      display: grid;
    }
    .box {
      width: 30px;
      height: 40px;
      border: 1px solid #333;
    }
    .label {
      margin-left: 10px;
      font-weight: bold;
      min-width: 80px;
    }
  </style>
</head>
<body>
<div class="container">
  <h2>Hitung Sisi A3 Softcover</h2>
  <label>Ukuran Softcover</label>
  <select id="ukuran">
    <option value="A4">A4</option>
    <option value="A5">A5</option>
    <option value="A6">A6</option>
  </select>
  <label>Jumlah Halaman Isi per Buku</label>
  <input type="number" id="halamanIsi" min="0" />
  <label>Jumlah Buku</label>
  <input type="number" id="jumlahBuku" min="1" />
  <label>Tipe Cetak Isi</label>
  <select id="tipeIsi">
    <option value="1">1 Sisi</option>
    <option value="2">Bolak-balik</option>
  </select>
  <button onclick="hitung()">Hitung</button>
  <div class="result" id="hasil"></div>
  <div class="impose-layout" id="visual"></div>
</div>

<script>
function randomColor(){
  let colors=["#FF5733","#33FF57","#3357FF","#FF33A8","#FFD433","#33FFF5","#8D33FF"];
  return colors[Math.floor(Math.random()*colors.length)];
}

function buatLayer(type, count, kotak){
  let visual = document.getElementById("visual");
  let layer = document.createElement("div");
  layer.className = "layer";

  let boxes = document.createElement("div");
  boxes.className = "boxes grid";

  let cols = kotak, rows = 1;
  if(type.includes("8")){cols = 4; rows = 2;}
  else if(type.includes("4")){cols = 2; rows = 2;}
  else if(type.includes("2")){cols = 2; rows = 1;}

  boxes.style.gridTemplateColumns = `repeat(${cols}, 30px)`;
  boxes.style.gridTemplateRows = `repeat(${rows}, 40px)`;

  for(let i = 0; i < kotak; i++){
    let b = document.createElement("div");
    b.className = "box";
    if(type.startsWith("R")){
      b.style.background = "#4CAF50";
    }else if(type.startsWith("CSR")){
      b.style.background = i < kotak/2 ? "#2196F3" : "#FFC107";
    }else if(type.startsWith("CS")){
      b.style.background = randomColor();
    }
    boxes.appendChild(b);
  }

  let label = document.createElement("div");
  label.className = "label";
  label.innerText = `${type} ${count}x`;

  layer.appendChild(boxes);
  layer.appendChild(label);
  visual.appendChild(layer);
}

function hitung(){
  const ukuran=document.getElementById("ukuran").value;
  const halamanIsi=parseInt(document.getElementById("halamanIsi").value);
  const jumlahBuku=parseInt(document.getElementById("jumlahBuku").value);
  const tipeIsi=parseInt(document.getElementById("tipeIsi").value);
  const hasil=document.getElementById("hasil");

  if(isNaN(halamanIsi)||isNaN(jumlahBuku)){
    hasil.innerHTML="<p>Mohon isi semua data dengan benar.</p>";
    return;
  }

  let halamanPerBuku = halamanIsi;
  if (tipeIsi === 2 && halamanPerBuku % 2 !== 0){
    halamanPerBuku += 1;
  }

  let jumlahDalamSatuSet=1, divisor=1;

  if(ukuran==="A4"){jumlahDalamSatuSet=2; divisor=2;}
  else if(ukuran==="A5"){jumlahDalamSatuSet=4; divisor=4;}
  else if(ukuran==="A6"){jumlahDalamSatuSet=8; divisor=8;}

  let sisiSet = halamanPerBuku;
  let sisaBuku = jumlahBuku - jumlahDalamSatuSet;
  let sisiSisa = 0;
  if(sisaBuku > 0){
    sisiSisa = (halamanPerBuku * sisaBuku) / divisor;
    sisiSisa = Math.ceil(sisiSisa);
  }

  let totalSisiIsi = sisiSet + sisiSisa;
  let totalSisi = totalSisiIsi;
  if (tipeIsi === 2 && totalSisi % 2 !== 0) {
  totalSisi += 1;
}
  let keteranganImpose = "";
  let sisa = jumlahBuku;

  if(ukuran==="A4"){
    const r2=Math.floor(sisa/2); sisa%=2; const cs2=sisa;
    keteranganImpose = `${r2>0?`R2 ${r2}x `:""}${cs2>0?`CS2 ${cs2}x`:""}`;
  }else if(ukuran==="A5"){
    const r4=Math.floor(sisa/4); sisa%=4;
    const csr=Math.floor(sisa/2);
    const cs4=sisa%2;
    keteranganImpose = `${r4>0?`R4 ${r4}x `:""}${csr>0?`CSR4 ${csr}x `:""}${cs4>0?`CS4 ${cs4}x`:""}`;
  }else if(ukuran==="A6"){
    const r8=Math.floor(sisa/8); sisa%=8;
    let csr4=0; let cs8=0;
    if(sisa===4){csr4=1;}
    else if(sisa===1){cs8=1;}
    else if(sisa!==0){cs8=sisa;}
    keteranganImpose = `${r8>0?`R8 ${r8}x `:""}${csr4>0?`CSR8 ${csr4}x `:""}${cs8>0?`CS8 ${cs8}x`:""} (CS Perlu di binder!)`;
  }

  hasil.innerHTML = `<p><strong>Total semua sisi A3: ${totalSisi}</strong></p><p><strong>Impose: ${keteranganImpose.trim()}</strong></p>`;
  document.getElementById("visual").innerHTML = "";

  keteranganImpose.trim().split(/\s+/).forEach((val, i) => {
    if(val.match(/R|CS/)){
      let type = val;
      let count = parseInt(keteranganImpose.trim().split(/\s+/)[i+1]);
      if(!isNaN(count)){
        let kotak = type.includes("8") ? 8 : type.includes("4") ? 4 : 2;
        buatLayer(type, count, kotak);
      }
    }
  });
}
</script>
</body>
</html>
